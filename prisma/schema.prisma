generator client {
    provider = "prisma-client"
    output   = "../src/prisma/client"
}

datasource db {
    provider = "mysql"
}

enum ChannelType {
    TEXT
    VOICE
    CATEGORY
}

model Guild {
    id   String @id
    name String

    Channels       Channel[]
    Roles          Role[]
    Configurations Configuration[]
}

model Channel {
    id String @id

    type      ChannelType
    deletedAt DateTime?

    guildId String
    Guild   Guild  @relation(fields: [guildId], references: [id])

    SingleChannelConfigs ChannelConfiguration[]     @relation("SingleChannelConfigs")
    ListChannelConfigs   ChannelListConfiguration[] @relation("ListChannelConfigs")
}

model Role {
    id        String    @id
    deletedAt DateTime?

    guildId String
    Guild   Guild  @relation(fields: [guildId], references: [id])

    SingleRoleConfigs RoleConfiguration[]     @relation("SingleRoleConfigs")
    ListRoleConfigs   RoleListConfiguration[] @relation("ListRoleConfigs")
}

model Configuration {
    id    Int    @id @default(autoincrement())
    key   String
    value String

    guildId String
    Guild   Guild  @relation(fields: [guildId], references: [id])

    @@index([guildId, key])
}

model ChannelConfiguration {
    key String @id

    channelId String
    Channel   Channel @relation("SingleChannelConfigs", fields: [channelId], references: [id])
}

model ChannelListConfiguration {
    key String

    channelId String
    Channel   Channel @relation("ListChannelConfigs", fields: [channelId], references: [id])

    @@id([key, channelId])
}

model RoleConfiguration {
    key String @id

    roleId String
    Role   Role   @relation("SingleRoleConfigs", fields: [roleId], references: [id])
}

model RoleListConfiguration {
    key String

    roleId String
    Role   Role   @relation("ListRoleConfigs", fields: [roleId], references: [id])

    @@id([key, roleId])
}

model BotState {
    key       String   @id
    value     String
    updatedAt DateTime @updatedAt
}
